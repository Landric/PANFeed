{% extends "template.html" %}
{% load url from future %}
{% load crispy_forms_tags %}
{% block title %}Publish{% endblock title %}
{% block publish_nav %}active{% endblock publish_nav %}
{% block content %}
{% if object %}
    <h2>Edit Feed</h2>
{% else %}
    <h2>Create Feed</h2>
{% endif %}
<p>Fields marked * are required.</p>
<br/>
<form action="#" method="post" class="form-horizontal">
    {% csrf_token %}
    {{form|crispy}}
        <div class="control-group">
            <div class="controls">
                {% if object %}
                    <input type="submit" value="Save" class="btn btn-primary"/>&nbsp;&nbsp;
                {% else %}
                    <input type="submit" value="Create" class="btn btn-primary"/>&nbsp;&nbsp;
                {% endif %}
                <a href="{% url 'publishnews' %}" class="btn">Cancel</a>
            </div>
        </div>
    </fieldset>
</form>
    <br/>
    <br/>
    {% if object %}
        <div class="control-group">
            <label class="control-label">Items:</label>
                </div>
        {% for item in object.feeditem_set.all %}
            {% if forloop.first %}
                    <div class="control-group">
                        <div class="controls">
                            <table class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Date Published</th>
                                        <th>Edit</th>
                                        <th>Delete</th>
                                    </tr>
                                </thead>
                                <tbody>
            {% endif %}
                                    <tr class="item" id="item-{{item.id}}">
                                        <td>{{item.title}}</td>
                                        <td>{{item.created}}</td>
                                        <td><a href="{{ item.get_modify_url }}" class="btn">Edit</a></td>
                                        <td>
                                            <form action="{{item.get_modify_url}}" method="post">
                                                {% csrf_token %}
                                                <input type="hidden" name="_method" value="DELETE" />
                                                <input type="submit" value="Delete" class="btn"/>
                                            </form>
                                        </td>
                                    </tr>
            {% if forloop.last %}
                                </tbody>
                            </table>
                        </div>
            {% endif %}
            {% empty %}
                <div class="controls">
                    <p>There are currently no items in this Feed</p>
                </div>
            {% endfor %}
            {% if object %}
                    <a class="btn btn-primary" href="{% url 'newitem' object.slug %}">Publish an item</a>
                    <a class="btn btn-primary" href="{% url 'newissue' object.slug %}">Publish a Special Issue</a>
            {% endif %}
        </div>
    {% endif %}
{% endblock content %}
